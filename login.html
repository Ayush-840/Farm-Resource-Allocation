<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriOptima - Login</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="login-body">
    <!-- Language Selection Dropdown -->
    <div class="lang-selector-container">
        <select id="lang-selector" class="glass-select lang-select">
            <option value="en" selected>English</option>
            <option value="hi">हिंदी (Hindi)</option>
            <option value="mr">मराठी (Marathi)</option>
            <option value="ta">தமிழ் (Tamil)</option>
        </select>
    </div>

    <div class="login-container">
        <!-- Leaf graphics behind login -->
        <div class="abstract-shape shape-1"></div>
        <div class="abstract-shape shape-2"></div>

        <div class="login-glass-panel">
            <div class="login-header">
                <div class="logo-icon large-icon"></div>
                <h1 data-i18n="login-title">AgriOptima</h1>
                <p data-i18n="login-subtitle">Intelligent Resource Management</p>
            </div>

            <form id="login-form">
                <div id="error-container"
                    style="display:none; background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.3); border-radius: 8px; padding: 10px; margin-bottom: 15px; text-align: center;">
                    <p id="error-msg" style="color: #ff6b6b; font-size: 0.9rem; margin-bottom: 8px;"
                        data-i18n="error-incorrect">Incorrect credentials.</p>
                    <div id="error-actions" style="display: flex; gap: 10px; justify-content: center;">
                        <button type="button" id="retry-btn"
                            style="padding: 6px 15px; font-size: 0.85rem; background: transparent; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; cursor: pointer; transition: 0.2s;"
                            data-i18n="retry-btn">Retry</button>
                        <button type="button" id="send-otp-btn"
                            style="padding: 6px 15px; font-size: 0.85rem; background: var(--primary); border: none; border-radius: 6px; color: white; cursor: pointer; transition: 0.2s;"
                            data-i18n="send-otp-btn">Send OTP</button>
                    </div>
                </div>

                <div class="input-flat-group" id="uid-group">
                    <label for="uid" data-i18n="login-id">Farmer ID / Phone Number</label>
                    <input type="text" id="uid" class="flat-input" placeholder="e.g. +91 98765 43210" required>
                </div>

                <div class="input-flat-group" id="pwd-group">
                    <label for="pwd" data-i18n="login-pwd">Secure PIN</label>
                    <input type="password" id="pwd" class="flat-input" placeholder="••••••" required>
                </div>

                <div class="input-flat-group" id="otp-group" style="display:none;">
                    <label for="otp" data-i18n="otp-label">Enter OTP (default: 1234)</label>
                    <input type="text" id="otp" class="flat-input" placeholder="1234" maxlength="4">
                </div>

                <div class="options-row">
                    <label class="checkbox-container">
                        <input type="checkbox" checked>
                        <span class="checkmark"></span>
                        <span data-i18n="login-remember">Remember Device</span>
                    </label>
                    <a href="#" class="forgot-link" data-i18n="login-forgot">Forgot PIN?</a>
                </div>

                <button type="submit" class="primary-btn login-btn" id="submit-btn">
                    <span data-i18n="login-button">Access Planner</span>
                </button>
            </form>

            <div class="login-footer">
                <p id="toggle-text"><span data-i18n="login-no-account">Don't have an account?</span> <a href="#"
                        id="toggle-form-btn" data-i18n="login-register">Register Farm</a></p>
            </div>
        </div>
    </div>

    <!-- Multi-language dict object and simple redirect -->
    <script>
        const translations = {
            'en': {
                'login-title': 'AgriOptima',
                'login-subtitle': 'Intelligent Resource Management',
                'login-id': 'Farmer ID / Phone Number',
                'login-pwd': 'Secure PIN',
                'login-remember': 'Remember Device',
                'login-forgot': 'Forgot PIN?',
                'login-button': 'Access Planner',
                'login-no-account': 'Don\'t have an account?',
                'login-register': 'Register Farm',
                // New register specific
                'reg-subtitle': 'Create your secure farm profile',
                'reg-button': 'Create Account',
                'reg-has-account': 'Already registered?',
                'reg-login': 'Log In here',
                'error-incorrect': 'Incorrect credentials.',
                'retry-btn': 'Retry',
                'send-otp-btn': 'Send OTP',
                'otp-label': 'Enter OTP (default: 1234)',
                'verify-otp-btn': 'Verify OTP'
            },
            'hi': {
                'login-title': 'एग्रीऑप्टिमा (AgriOptima)',
                'login-subtitle': 'स्मार्ट संसाधन प्रबंधन',
                'login-id': 'किसान आईडी / फोन नंबर',
                'login-pwd': 'सुरक्षित पिन',
                'login-remember': 'डिवाइस याद रखें',
                'login-forgot': 'पिन भूल गए?',
                'login-button': 'प्लानर खोलें',
                'login-no-account': 'खाता नहीं है?',
                'login-register': 'खेत पंजीकृत करें',
                // New register specific
                'reg-subtitle': 'अपना सुरक्षित खेत प्रोफाइल बनाएं',
                'reg-button': 'खाता बनाएं',
                'reg-has-account': 'पहले से पंजीकृत हैं?',
                'reg-login': 'लॉग इन करें',
                'error-incorrect': 'गलत क्रेडेंशियल।',
                'retry-btn': 'पुनः प्रयास करें',
                'send-otp-btn': 'OTP भेजें',
                'otp-label': 'OTP दर्ज करें (डिफ़ॉल्ट: 1234)',
                'verify-otp-btn': 'OTP सत्यापित करें'
            },
            'mr': {
                'login-title': 'अ‍ॅग्रीऑप्टिमा',
                'login-subtitle': 'स्मार्ट संसाधन व्यवस्थापन',
                'login-id': 'शेतकरी आयडी / फोन नंबर',
                'login-pwd': 'सुरक्षित पिन',
                'login-remember': 'डिव्हाइस लक्षात ठेवा',
                'login-forgot': 'पिन विसरलात?',
                'login-button': 'प्लॅनर उघडा',
                'login-no-account': 'खाते नाही?',
                'login-register': 'शेत नोंदणी',
                // New register specific
                'reg-subtitle': 'तुमचे सुरक्षित शेत प्रोफाइल तयार करा',
                'reg-button': 'खाते तयार करा',
                'reg-has-account': 'आधीच नोंदणीकृत आहात?',
                'reg-login': 'येथे लॉग इन करा',
                'error-incorrect': 'चुकीची क्रेडेंशियल.',
                'retry-btn': 'पुन्हा प्रयत्न करा',
                'send-otp-btn': 'OTP पाठवा',
                'otp-label': 'OTP प्रविष्ट करा (डीफॉल्ट: 1234)',
                'verify-otp-btn': 'OTP सत्यापित करा'
            },
            'ta': {
                'login-title': 'அக்ரிஆப்டிமா',
                'login-subtitle': 'ஸ்மார்ட் வள மேலாண்மை',
                'login-id': 'விவசாயி ஐடி / தொலைபேசி',
                'login-pwd': 'பாதுகாப்பு பின்',
                'login-remember': 'நினைவில் கொள்',
                'login-forgot': 'பின்னை மறந்துவிட்டீர்களா?',
                'login-button': 'திட்டமிடுபவரை அணுகவும்',
                'login-no-account': 'கணக்கு இல்லையா?',
                'login-register': 'பதிவு செய்',
                // New register specific
                'reg-subtitle': 'உங்கள் பண்ணை சுயவிவரத்தை உருவாக்கவும்',
                'reg-button': 'கணக்கை உருவாக்கு',
                'reg-has-account': 'ஏற்கனவே பதிவு செய்துள்ளீர்களா?',
                'reg-login': 'உள்நுழைய',
                'error-incorrect': 'தவறான சான்றுகள்.',
                'retry-btn': 'மீண்டும் முயற்சி செய்',
                'send-otp-btn': 'OTP அனுப்பு',
                'otp-label': 'OTP ஐ உள்ளிடவும் (இயல்பு: 1234)',
                'verify-otp-btn': 'OTP ஐ சரிபார்க்கவும்'
            }
        };

        const langSelector = document.getElementById('lang-selector');

        langSelector.addEventListener('change', (e) => {
            const lang = e.target.value;
            // Save preference to localStorage so index.html can use it
            localStorage.setItem('agriLanguage', lang);

            // Translate the page
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        });

        let isOtpState = false;
        let expectedOtp = '1234';

        document.getElementById('retry-btn').addEventListener('click', () => {
            document.getElementById('error-container').style.display = 'none';
            document.getElementById('pwd').value = '';
            document.getElementById('pwd').focus();
        });

        document.getElementById('send-otp-btn').addEventListener('click', () => {
            document.getElementById('error-container').style.display = 'none';
            document.getElementById('pwd-group').style.display = 'none';
            document.getElementById('otp-group').style.display = 'block';
            document.querySelector('.options-row').style.display = 'none';

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.innerHTML = '<span data-i18n="verify-otp-btn">Verify OTP</span>';

            // Try to re-translate the button if translation text exists
            const savedLang = localStorage.getItem('agriLanguage') || 'en';
            if (translations[savedLang] && translations[savedLang]['verify-otp-btn']) {
                submitBtn.querySelector('span').textContent = translations[savedLang]['verify-otp-btn'];
            }

            isOtpState = true;

            // Simulate sending OTP
            const userPhone = document.getElementById('uid').value;
            alert("OTP " + expectedOtp + " sent to " + userPhone + " for verification.");
        });

        // Handle Login / Reg -> Redirects to main app
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const btn = document.getElementById('submit-btn');
            const uid = document.getElementById('uid').value;
            const pwd = document.getElementById('pwd').value;

            if (isRegisterState) {
                btn.innerHTML = '<span>Registering...</span>';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                return;
            }

            if (isOtpState) {
                const enteredOtp = document.getElementById('otp').value;
                if (enteredOtp === expectedOtp) {
                    btn.innerHTML = '<span>Verifying OTP...</span>';
                    setTimeout(() => { window.location.href = 'index.html'; }, 1000);
                } else {
                    document.getElementById('error-container').style.display = 'block';
                    document.getElementById('error-msg').innerText = "Incorrect OTP. Please try again.";
                    document.getElementById('error-actions').style.display = 'none';
                }
                return;
            }

            // For dummy verification, let's treat any UID/PWD that are blank as false, and if they don't match specific ones
            if (uid === '+91 98765 43210' && pwd === '123456') {
                btn.innerHTML = '<span>Verifying...</span>';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } else {
                // Incorrect credentials
                document.getElementById('error-container').style.display = 'block';
                document.getElementById('error-msg').innerText = "Incorrect credentials. Please retry or verify via OTP.";
                document.getElementById('error-actions').style.display = 'flex';
            }
        });

        // --- Toggling Login vs Register State ---
        let isRegisterState = false;

        document.getElementById('toggle-form-btn').addEventListener('click', (e) => {
            e.preventDefault();
            isRegisterState = !isRegisterState;

            const subtitle = document.querySelector('.login-header p');
            const submitTextWrapper = document.querySelector('#submit-btn span');
            const toggleTextWrap = document.querySelector('#toggle-text');
            const toggleBtn = document.getElementById('toggle-form-btn');

            if (isRegisterState) {
                // Switch to Register UI
                subtitle.setAttribute('data-i18n', 'reg-subtitle');
                submitTextWrapper.setAttribute('data-i18n', 'reg-button');
                document.querySelector('.options-row').style.display = 'none'; // hide remember me

                toggleTextWrap.innerHTML = `<span data-i18n="reg-has-account">Already registered?</span> <a href="#" id="toggle-form-btn" data-i18n="reg-login">Log In here</a>`;
            } else {
                // Switch to Login UI
                subtitle.setAttribute('data-i18n', 'login-subtitle');
                submitTextWrapper.setAttribute('data-i18n', 'login-button');
                document.querySelector('.options-row').style.display = 'flex'; // show remember me

                toggleTextWrap.innerHTML = `<span data-i18n="login-no-account">Don't have an account?</span> <a href="#" id="toggle-form-btn" data-i18n="login-register">Register Farm</a>`;
            }

            // Re-attach listener to newly created link
            document.getElementById('toggle-form-btn').addEventListener('click', arguments.callee);

            // Force re-translate current language state
            langSelector.dispatchEvent(new Event('change'));
        });

        // Auto-load saved language on load
        const savedLang = localStorage.getItem('agriLanguage');
        if (savedLang && translations[savedLang]) {
            langSelector.value = savedLang;
            langSelector.dispatchEvent(new Event('change'));
        }
    </script>
</body>

</html>